<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Nhập liệu – Quang Minh</title>
<style>
:root{
  --bg:#f2f2f7;          /* nền iOS */
  --card:#ffffff;
  --primary:#007aff;
  --radius:12px;
  --shadow:0 2px 12px rgba(0,0,0,.06);
}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Arial,sans-serif}
body{margin:0;background:var(--bg);font-size:16px;color:#000}
.container{max-width:600px;margin:auto;padding:16px}
h3{margin:0 0 16px;font-weight:600;font-size:20px}

/* field chung: trắng – bo tròn – đổ bóng */
.inp{
  width:100%;
  border:none;
  outline:none;
  padding:8px 16px;
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  font-size:15px;
}
.row{margin-bottom:12px}
.row input,.row textarea{resize:none}
.row textarea{height:80px}

/* card sản phẩm */
.proItem{
  background:#ffffff21;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:16px;
  margin-bottom:16px;
}
.proItem hr{display:none}   /* bỏ đường kẻ cũ */

input.pImg.inp {
    width: 60%;
}

/* nút + upload */
.upload-btn{
  width:32px;height:32px;border-radius:50%;
  background:var(--primary);color:#fff;
  display:inline-flex;align-items:center;justify-content:center;
  margin-left:8px;font-size:20px;cursor:pointer;
}
input[type=file]{display:none}

/* 2 ô Số lượng – Đơn giá cùng hàng */
.dual{
  display:flex;justify-content:space-between;
}
.dual>div{width:48%}
.dual label{font-weight:600;font-size:14px;margin-bottom:4px;display:block}

/* nút hành động */
.btn{
  padding:12px 20px;border:none;border-radius:var(--radius);
  font-size:16px;font-weight:500;color:#fff;cursor:pointer;
}
#addBtn{background:var(--primary);}
#okBtn{background:#34c759;width:100%; margin-top: 30px;}
</style>
</head>
<body>
<div class="container">
  <h3>Nhập thông tin</h3>

  <div class="row"><input id="fCompany" class="inp" placeholder="Tên công ty"></div>
  <div class="row"><input id="fAddress" class="inp" placeholder="Địa chỉ"></div>
  <div class="row"><input id="fTax" class="inp" placeholder="Mã số thuế"></div>

  <div id="proList">
    <div class="proItem">
      <div class="row"><input class="pName inp" placeholder="Tên sản phẩm"></div>
      <div class="row"><textarea class="pInfo inp" rows="3">• Giới hạn cân:
• Bước nhảy: d=
• Bảo hành 1 năm</textarea></div>
      <div class="row">
        <input type="text" class="pImg inp" placeholder="Link ảnh">
        <label class="upload-btn" onclick="this.nextElementSibling.click()">+</label>
        <input type="file" accept="image/*" onchange="uploadImg(this)">
      </div>
      <div class="dual">
        <div>
          <label>Số lượng</label>
          <input type="number" class="pQty inp" value="1">
        </div>
        <div>
          <label>Đơn giá</label>
          <input type="text" class="pPrice inp" placeholder="đ" oninput="formatPriceModal(this)">
        </div>
      </div>
    </div>
  </div>

  <button id="addBtn" class="btn" onclick="addPro()">+ Thêm SP</button>
  <div style="margin-top:16px">
    <button id="okBtn" class="btn" onclick="saveAndGo()">Hoàn tất</button>
  </div>
</div>

<script>
function addPro(){
  const d=document.createElement('div');d.className='proItem';
  d.innerHTML=`
    <div class="row"><input class="pName inp" placeholder="Tên sản phẩm"></div>
    <div class="row"><textarea class="pInfo inp" rows="3">• Giới hạn cân:
• Bước nhảy: d=
• Bảo hành 1 năm</textarea></div>
    <div class="row">
      <input type="text" class="pImg inp" placeholder="Link ảnh">
      <label class="upload-btn" onclick="this.nextElementSibling.click()">+</label>
      <input type="file" accept="image/*" onchange="uploadImg(this)">
    </div>
    <div class="dual">
      <div>
        <label>Số lượng</label>
        <input type="number" class="pQty inp" value="1">
      </div>
      <div>
        <label>Đơn giá</label>
        <input type="text" class="pPrice inp" placeholder="đ" oninput="formatPriceModal(this)">
      </div>
    </div>`;
  document.getElementById('proList').appendChild(d);
}

function formatPriceModal(inp){
  let v=inp.value.replace(/\D/g,'');
  inp.value=v?parseFloat(v).toLocaleString('vi-VN'):'';
}
function uploadImg(input){
  if(input.files&&input.files[0]){
    const reader=new FileReader();
    reader.onload=e=>input.parentElement.querySelector('.pImg').value=e.target.result;
    reader.readAsDataURL(input.files[0]);
  }
}
function saveAndGo(){
  const data={
    company:document.getElementById('fCompany').value.trim(),
    address:document.getElementById('fAddress').value.trim(),
    tax:document.getElementById('fTax').value.trim(),
    products:[...document.querySelectorAll('.proItem')].map(p=>({
      name:p.querySelector('.pName').value.trim(),
      info:p.querySelector('.pInfo').value.trim(),
      img:p.querySelector('.pImg').value.trim(),
      qty:parseFloat(p.querySelector('.pQty').value)||0,
      price:parseFloat(p.querySelector('.pPrice').value.replace(/\./g,''))||0
    })).filter(x=>x.name)
  };
  localStorage.setItem('qmData',JSON.stringify(data));
  location.href='/innhanh.html';
}
</script>
</body>
</html>
